(function(){var c=/\{([^\}]+)\}/g,a=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,b=function(g,f,h){var e=h;f.replace(a,function(k,j,i,m,l){j=j||m;if(e){if(j in e){e=e[j]}typeof e=="function"&&l&&(e=e())}});e=(e==null||e==h?g:e)+"";return e},d=function(f,e){return String(f).replace(c,function(h,g){return b(h,g,e)})};Raphael.fn.popup=function(f,e,p,j,A){j=String(j||"top-middle").split("-");j[1]=j[1]||"middle";var q=5,g=p.getBBox(),n=Math.round(g.width),z=Math.round(g.height),l=Math.round(g.x)-q,k=Math.round(g.y)-q,s=Math.min(z/2,n/2,10),t={top:"M{x},{y}h{w4},{w4},{w4},{w4}a{r},{r},0,0,1,{r},{r}v{h4},{h4},{h4},{h4}a{r},{r},0,0,1,-{r},{r}l-{right},0-{gap},{gap}-{gap}-{gap}-{left},0a{r},{r},0,0,1-{r}-{r}v-{h4}-{h4}-{h4}-{h4}a{r},{r},0,0,1,{r}-{r}z",bottom:"M{x},{y}l{left},0,{gap}-{gap},{gap},{gap},{right},0a{r},{r},0,0,1,{r},{r}v{h4},{h4},{h4},{h4}a{r},{r},0,0,1,-{r},{r}h-{w4}-{w4}-{w4}-{w4}a{r},{r},0,0,1-{r}-{r}v-{h4}-{h4}-{h4}-{h4}a{r},{r},0,0,1,{r}-{r}z",right:"M{x},{y}h{w4},{w4},{w4},{w4}a{r},{r},0,0,1,{r},{r}v{h4},{h4},{h4},{h4}a{r},{r},0,0,1,-{r},{r}h-{w4}-{w4}-{w4}-{w4}a{r},{r},0,0,1-{r}-{r}l0-{bottom}-{gap}-{gap},{gap}-{gap},0-{top}a{r},{r},0,0,1,{r}-{r}z",left:"M{x},{y}h{w4},{w4},{w4},{w4}a{r},{r},0,0,1,{r},{r}l0,{top},{gap},{gap}-{gap},{gap},0,{bottom}a{r},{r},0,0,1,-{r},{r}h-{w4}-{w4}-{w4}-{w4}a{r},{r},0,0,1-{r}-{r}v-{h4}-{h4}-{h4}-{h4}a{r},{r},0,0,1,{r}-{r}z"},i={hx0:f-(l+q+n-s*2),hx1:f-(l+q+n/2-s),hx2:f-(l+q+s),vhy:e-(k+q+z+q+s),"^hy":e-(k-s)},v=[{x:l+q,y:k,w:n,w4:n/4,h4:z/4,right:0,left:n-s*2,bottom:0,top:z-s*2,r:q,h:z,gap:s},{x:l+q,y:k,w:n,w4:n/4,h4:z/4,left:n/2-s,right:n/2-s,top:z/2-s,bottom:z/2-s,r:q,h:z,gap:s},{x:l+q,y:k,w:n,w4:n/4,h4:z/4,left:0,right:n-s*2,top:0,bottom:z-s*2,r:q,h:z,gap:s}][j[1]=="middle"?1:(j[1]=="top"||j[1]=="left")*2];var o=0,m=0,u=this.path(d(t[j[0]],v)).insertBefore(p);switch(j[0]){case"top":o=f-(l+q+v.left+s);m=e-(k+q+z+q+s);break;case"bottom":o=f-(l+q+v.left+s);m=e-(k-s);break;case"left":o=f-(l+q+n+q+s);m=e-(k+q+v.top+s);break;case"right":o=f-(l-s);m=e-(k+q+v.top+s);break}u.translate(o,m);if(A){A=u.attr("path");u.remove();return{path:A,dx:o,dy:m}}p.translate(o,m);return u}})();(function(){Raphael.fn.timeline={draw:function(c,f){var d={color:c.color||"#f00",normal_r:c.normal_r||7,highlight_r:c.highlight_r||10,highlight_fill:c.highlight_fill||c.color||"#f00",normal_fill:c.normal_fill||"#fff",popup_text_attr:c.popup_text_attr||{fill:"#000",font:"10px verdana, arial, helvetica, sans-serif"},popup_attr:c.bubble_attr||{fill:c.normal_fill||"#fff","stroke-width":2,stroke:c.color||"#f00"}},b=c.events.sort(a.sort_by_date(false)),g=100,e=a.days_diff(b[0].date,b[b.length-1].date);if(e>0){g=(this.width-60)/e}this.timeline.draw_timescale(b,{x_offset:30,days_range:e});this.timeline.draw_events(b,d,{pixels_per_day:g,x_offset:30,y_offset:this.height-70},f)},draw_events:function(n,f,g,d){var j=[],m=g.x_offset,l=this.text(40,g.y_offset-25,"title").attr(f.popup_text_attr).attr({"font-weight":"bold","font-size":"12px"}),e=this.text(40,g.y_offset-10,"date").attr(f.popup_text_attr),k=this.set().push(l,e).hide(),c="";for(var h=0;h<n.length;h++){var b=a.getX(n[0].date,n[h].date,g.pixels_per_day)+g.x_offset;if(h>0){m=a.getX(n[0].date,n[h-1].date,g.pixels_per_day)+g.x_offset;if(b<(m+f.normal_r*2)){b=m+f.normal_r*2}this.path("M"+m+" "+g.y_offset+"L"+b+" "+g.y_offset).attr({stroke:f.color,"stroke-width":3}).toBack()}j[h]=this.circle(b,g.y_offset,f.normal_r).attr({fill:f.normal_fill,stroke:f.color,"stroke-width":2});(function(i,o){j[h].hover(function(){this.attr({r:f.highlight_r});var q=(o.name.length>40)?o.name.substring(0,40)+"...":o.name;l.attr({text:q});e.attr({text:o.date});k.show();var p=this.getBBox().x+this.getBBox().width/2;c=i.popup(p,g.y_offset-15,k,"top-middle").attr(f.popup_attr);if(c.getBBox().x<g.x_offset){c.remove();c=i.popup(p,g.y_offset-15,k,"top-left").attr(f.popup_attr)}else{if((c.getBBox().x+c.getBBox().width)>(i.width-40)){c.remove();c=i.popup(p,g.y_offset-15,k,"top-right").attr(f.popup_attr)}}document.body.style.cursor="pointer"},function(){this.attr({r:f.normal_r});k.hide();c.remove();document.body.style.cursor="default"});j[h].click(function(){d(o);for(var p=0;p<j.length;p++){j[p].attr({fill:f.normal_fill})}this.attr({fill:f.highlight_fill})})})(this,n[h])}},draw_timescale:function(o,c){var d=c.days_range,g=c.x_offset,j=this.height-50,l=100,h="",m=new Date(o[0].date),f=new Date(o[o.length-1].date);if(d>1){l=(this.width-60)/d}if(d<28){h=m}else{h=a.next_unit(m,d)}if(d<28){var b=m.getMonth(),i=f.getMonth();if(b!==i){this.text(40,j+20,a.month_in_words(b)+" "+m.getFullYear());this.text(this.width-40,j+20,a.month_in_words(i)+" "+f.getFullYear())}else{this.text(this.width/2,j+20,a.month_in_words(b)+" "+m.getFullYear())}}else{if(d<730&&h.getMonth()!=0){this.text(g,j+20,h.getFullYear())}}for(var n=h;n.getTime()<=f.getTime();n=a.next_unit(n,d)){var k=a.getX(m,n,l)+g,e="";if(d<28){e=n.getDate()}else{if(d<730){e=a.month_in_words(n.getMonth());if(n.getMonth()==0){this.text(k,j+20,n.getFullYear())}}else{e=n.getFullYear()}}this.text(k,j,e)}}};function a(){}a.sort_by_date=function(b){var c=(b)?-1:1;return function(e,d){var f=new Date(e.date),g=new Date(d.date);if(f<g){return(c*-1)}if(f>g){return(c*1)}return 0}};a.days_diff=function(c,b){return Math.ceil((new Date(b).getTime()-new Date(c).getTime())/a.day_in_ms())};a.getX=function(c,b,d){return d*a.days_diff(c,b)};a.month_in_words=function(c){var b="";switch(c){case 0:b="January";break;case 1:b="February";break;case 2:b="March";break;case 3:b="April";break;case 4:b="May";break;case 5:b="June";break;case 6:b="July";break;case 7:b="August";break;case 8:b="September";break;case 9:b="October";break;case 10:b="November";break;case 11:b="December";break;default:b="n/a"}return b.substring(0,3)};a.day_in_ms=function(){return 86400000};a.next_unit=function(g,e){if(e<28){return new Date(g.getTime()+a.day_in_ms())}else{if(e<730){var b=(g.getMonth()==11)?g.getFullYear()+1:g.getFullYear(),f=(g.getMonth()==11)?0:g.getMonth()+1;return new Date(b,f,1)}else{if(e<3650){return new Date(g.getFullYear()+1,0,1)}else{var c=g.getFullYear()%5;return new Date(g.getFullYear()+(5-c),0,1)}}}}})();